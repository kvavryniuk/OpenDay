<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ü–∏—Ñ—Ä</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
</head>
<body>
    <header>
        <h1>‚úçÔ∏è –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ä—É–∫–æ–ø–∏—Å–Ω–∏—Ö —Ü–∏—Ñ—Ä</h1>
        <p>–ù–∞–º–∞–ª—é–π—Ç–µ —Ü–∏—Ñ—Ä—É –≤—ñ–¥ 0 –¥–æ 9, —ñ –Ω–µ–π—Ä–æ–Ω–Ω–∞ –º–µ—Ä–µ–∂–∞ —ó—ó —Ä–æ–∑–ø—ñ–∑–Ω–∞—î</p>
    </header>

    <nav class="main-nav">
        <a href="index.html" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="object-detection.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤</a>
        <a href="color-recognition.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤</a>
        <a href="pose-detection.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ø–æ–∑–∏</a>
        <a href="digit-recognition.html" class="nav-link active">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ü–∏—Ñ—Ä</a>
    </nav>

    <main class="container">
        <div class="demo-container">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–µ–π—Ä–æ–Ω–Ω–æ—ó –º–µ—Ä–µ–∂—ñ...</p>
            </div>

            <div id="app" style="display: none;">
                <div style="text-align: center; margin-bottom: 1rem;">
                    <p style="color: #667eea; font-size: 1.1rem;">
                        –ù–∞–º–∞–ª—é–π—Ç–µ —Ü–∏—Ñ—Ä—É –≤ –ø–æ–ª—ñ –Ω–∏–∂—á–µ
                    </p>
                </div>

                <div style="text-align: center;">
                    <canvas id="drawingCanvas" width="280" height="280"></canvas>
                </div>

                <div class="controls" style="margin-top: 1rem;">
                    <button id="clearBtn" class="btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
                    <button id="predictBtn" class="btn">üîç –†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏</button>
                </div>

                <div class="results">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</h3>
                    <div id="predictions">
                        <p style="color: #999; text-align: center;">–ù–∞–º–∞–ª—é–π—Ç–µ —Ü–∏—Ñ—Ä—É —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏"</p>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 12px;">
                    <h3 style="color: #667eea; margin-bottom: 1rem; text-align: center;">–ü–æ—Ä–∞–¥–∏ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</h3>
                    <ul style="color: #666; line-height: 2;">
                        <li>–ú–∞–ª—é–π—Ç–µ —Ü–∏—Ñ—Ä—É –≤–µ–ª–∏–∫–æ—é, —â–æ–± –≤–æ–Ω–∞ –∑–∞–π–º–∞–ª–∞ –±—ñ–ª—å—à—É —á–∞—Å—Ç–∏–Ω—É –ø–æ–ª—è</li>
                        <li>–ù–∞–º–∞–≥–∞–π—Ç–µ—Å—è –ø–∏—Å–∞—Ç–∏ —á—ñ—Ç–∫–æ —Ç–∞ —Ä–æ–∑–±—ñ—Ä–ª–∏–≤–æ</li>
                        <li>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Å–ø–æ—Å—ñ–± –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ü–∏—Ñ—Ä</li>
                        <li>–î–ª—è –∫—Ä–∞—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤, –º–∞–ª—é–π—Ç–µ –ø–æ–≤—ñ–ª—å–Ω–æ —ñ –∞–∫—É—Ä–∞—Ç–Ω–æ</li>
                    </ul>
                </div>
            </div>
        </div>

        <section class="info-section">
            <h2>–Ø–∫ –ø—Ä–∞—Ü—é—î —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è?</h2>
            <div class="info-grid">
                <div class="info-item">
                    <h3>1. –ú–∞–ª—é–≤–∞–Ω–Ω—è</h3>
                    <p>–í–∏ –º–∞–ª—é—î—Ç–µ —Ü–∏—Ñ—Ä—É –Ω–∞ –ø–æ–ª–æ—Ç–Ω—ñ —Ä–æ–∑–º—ñ—Ä–æ–º 280√ó280 –ø—ñ–∫—Å–µ–ª—ñ–≤</p>
                </div>
                <div class="info-item">
                    <h3>2. –û–±—Ä–æ–±–∫–∞</h3>
                    <p>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–º–µ–Ω—à—É—î—Ç—å—Å—è –¥–æ 28√ó28 –ø—ñ–∫—Å–µ–ª—ñ–≤ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç MNIST)</p>
                </div>
                <div class="info-item">
                    <h3>3. –ê–Ω–∞–ª—ñ–∑</h3>
                    <p>–ù–µ–π—Ä–æ–Ω–Ω–∞ –º–µ—Ä–µ–∂–∞ –∞–Ω–∞–ª—ñ–∑—É—î –ø–∞—Ç–µ—Ä–Ω–∏ –ø—ñ–∫—Å–µ–ª—ñ–≤</p>
                </div>
                <div class="info-item">
                    <h3>4. –†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                    <p>–ú–æ–¥–µ–ª—å –≤–∏–¥–∞—î –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ü–∏—Ñ—Ä–∏ 0-9</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∑–≥–æ—Ä—Ç–∫–æ–≤—É –Ω–µ–π—Ä–æ–Ω–Ω—É –º–µ—Ä–µ–∂—É (CNN), –Ω–∞–≤—á–µ–Ω—É –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç—ñ MNIST</p>
    </footer>

    <script>
        let model;
        let canvas;
        let ctx;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        async function loadModel() {
            try {
                // –°—Ç–≤–æ—Ä—é—î–º–æ –ø—Ä–æ—Å—Ç—É CNN –º–æ–¥–µ–ª—å –¥–ª—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ü–∏—Ñ—Ä
                model = tf.sequential({
                    layers: [
                        tf.layers.conv2d({
                            inputShape: [28, 28, 1],
                            kernelSize: 3,
                            filters: 32,
                            activation: 'relu'
                        }),
                        tf.layers.maxPooling2d({ poolSize: 2 }),
                        tf.layers.conv2d({
                            kernelSize: 3,
                            filters: 64,
                            activation: 'relu'
                        }),
                        tf.layers.maxPooling2d({ poolSize: 2 }),
                        tf.layers.flatten(),
                        tf.layers.dense({ units: 128, activation: 'relu' }),
                        tf.layers.dropout({ rate: 0.2 }),
                        tf.layers.dense({ units: 10, activation: 'softmax' })
                    ]
                });

                // –ö–æ–º–ø—ñ–ª—é—î–º–æ –º–æ–¥–µ–ª—å
                model.compile({
                    optimizer: 'adam',
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });

                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                document.getElementById('loading').innerHTML = 
                    '<p style="color: red;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ.</p>';
            }
        }

        function initCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // –ë—ñ–ª–∏–π —Ñ–æ–Ω
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 15;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();

            lastX = x;
            lastY = y;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();

            lastX = x;
            lastY = y;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            document.getElementById('predictions').innerHTML = 
                '<p style="color: #999; text-align: center;">–ù–∞–º–∞–ª—é–π—Ç–µ —Ü–∏—Ñ—Ä—É —Ç–∞ –Ω–∞—Ç—ñ—Å–Ω—ñ—Ç—å "–†–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏"</p>';
        }

        function preprocessCanvas() {
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π canvas 28x28
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = 28;
            tempCanvas.height = 28;
            const tempCtx = tempCanvas.getContext('2d');
            
            // –ó–º–µ–Ω—à—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            tempCtx.drawImage(canvas, 0, 0, 28, 28);
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –¥–∞–Ω—ñ –ø—ñ–∫—Å–µ–ª—ñ–≤
            const imageData = tempCtx.getImageData(0, 0, 28, 28);
            
            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ —Ç–µ–Ω–∑–æ—Ä
            const tensor = tf.browser.fromPixels(imageData, 1)
                .toFloat()
                .div(255.0)
                .reshape([1, 28, 28, 1]);
            
            return tensor;
        }

        async function predict() {
            const tensor = preprocessCanvas();
            
            // –û—Ç—Ä–∏–º—É—î–º–æ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è
            const predictions = await model.predict(tensor).data();
            
            // –í—ñ–¥–æ–±—Ä–∞–∂–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
            displayPredictions(predictions);
            
            tensor.dispose();
        }

        function displayPredictions(predictions) {
            const predArray = Array.from(predictions);
            const maxIndex = predArray.indexOf(Math.max(...predArray));
            
            // –°–æ—Ä—Ç—É—î–º–æ –ø–æ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ
            const sorted = predArray
                .map((prob, digit) => ({ digit, prob }))
                .sort((a, b) => b.prob - a.prob);

            let html = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 4rem; color: #667eea; font-weight: bold;">
                        ${maxIndex}
                    </div>
                    <div style="color: #666; font-size: 1.2rem;">
                        –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: ${(sorted[0].prob * 100).toFixed(1)}%
                    </div>
                </div>
                <h4 style="color: #667eea; margin-bottom: 1rem;">–í—Å—ñ –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç—ñ:</h4>
            `;

            sorted.forEach(({ digit, prob }) => {
                const percentage = (prob * 100).toFixed(1);
                html += `
                    <div class="result-item">
                        <div>
                            <div class="result-label">–¶–∏—Ñ—Ä–∞ ${digit}</div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <span class="result-confidence">${percentage}%</span>
                    </div>
                `;
            });

            document.getElementById('predictions').innerHTML = html;
        }

        document.getElementById('clearBtn').addEventListener('click', clearCanvas);
        document.getElementById('predictBtn').addEventListener('click', predict);

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        loadModel();
        initCanvas();
    </script>
</body>
</html>
