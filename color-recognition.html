<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
</head>
<body>
    <header>
        <h1>üé® –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤</h1>
        <p>–ü–æ–∫–∞–∂—ñ—Ç—å –∫–æ–ª—å–æ—Ä–æ–≤–∏–π –æ–±'—î–∫—Ç –∫–∞–º–µ—Ä—ñ –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ</p>
    </header>

    <nav class="main-nav">
        <a href="index.html" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="object-detection.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤</a>
        <a href="color-recognition.html" class="nav-link active">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤</a>
        <a href="pose-detection.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –ø–æ–∑–∏</a>
        <a href="digit-recognition.html" class="nav-link">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ü–∏—Ñ—Ä</a>
    </nav>

    <main class="container">
        <div class="demo-container">
            <div class="controls">
                <button id="startBtn" class="btn">üì∑ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
                <button id="stopBtn" class="btn" style="display: none;">‚è∏Ô∏è –ó—É–ø–∏–Ω–∏—Ç–∏</button>
                <input type="file" id="uploadImage" accept="image/*" style="display: none;">
                <button id="uploadBtn" class="btn">üñºÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ</button>
                <button id="analyzeBtn" class="btn" style="display: none;">üîç –ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–ª—ñ—Ä</button>
            </div>

            <div class="video-container">
                <video id="webcam" autoplay playsinline></video>
                <canvas id="canvas" style="display: none;"></canvas>
            </div>

            <div id="colorDisplay" class="color-display" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <span id="colorName">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–æ—á–∞—Ç–∫—É</span>
            </div>

            <div class="results">
                <h3>–ê–Ω–∞–ª—ñ–∑ –∫–æ–ª—å–æ—Ä—É:</h3>
                <div id="colorInfo">
                    <div style="text-align: center; color: #999;">
                        <p>–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π –∫–æ–ª—ñ—Ä</p>
                    </div>
                </div>
            </div>
        </div>

        <section class="info-section">
            <h2>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h2>
            <p style="text-align: center; color: #666; margin-bottom: 1rem;">
                –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª—ñ–∑—É—î –ø—ñ–∫—Å–µ–ª—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∑–Ω–∞—á–∞—î –¥–æ–º—ñ–Ω—É—é—á–∏–π –∫–æ–ª—ñ—Ä, 
                –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ RGB-–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤ –ø—Ä–æ—Å—Ç—ñ—Ä –∫–æ–ª—å–æ—Ä—ñ–≤ HSV.
            </p>
            <div class="info-grid">
                <div class="info-item">
                    <h3>RGB ‚Üí HSV</h3>
                    <p>–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –∫–æ–ª—å–æ—Ä—ñ–≤ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è</p>
                </div>
                <div class="info-item">
                    <h3>–ê–Ω–∞–ª—ñ–∑ –≤—ñ–¥—Ç—ñ–Ω–∫—É</h3>
                    <p>–í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–ª—å–æ—Ä—É –∑–∞ –≤—ñ–¥—Ç—ñ–Ω–∫–æ–º</p>
                </div>
                <div class="info-item">
                    <h3>–ù–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å</h3>
                    <p>–û—Ü—ñ–Ω–∫–∞ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ —Ç–∞ –Ω–∞—Å–∏—á–µ–Ω–æ—Å—Ç—ñ</p>
                </div>
                <div class="info-item">
                    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                    <p>–ù–∞–∑–≤–∞ –∫–æ–ª—å–æ—Ä—É —Ç–∞ RGB-–∑–Ω–∞—á–µ–Ω–Ω—è</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∫–æ–ª—å–æ—Ä—ñ–≤</p>
    </footer>

    <script>
        let video;
        let canvas;
        let ctx;
        let stream;

        const colorNames = {
            red: { name: '–ß–µ—Ä–≤–æ–Ω–∏–π', emoji: 'üî¥', range: [0, 15, 345, 360] },
            orange: { name: '–ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π', emoji: 'üü†', range: [15, 45] },
            yellow: { name: '–ñ–æ–≤—Ç–∏–π', emoji: 'üü°', range: [45, 65] },
            lime: { name: '–°–∞–ª–∞—Ç–æ–≤–∏–π', emoji: 'üü¢', range: [65, 85] },
            green: { name: '–ó–µ–ª–µ–Ω–∏–π', emoji: 'üíö', range: [85, 150] },
            cyan: { name: '–ë–ª–∞–∫–∏—Ç–Ω–∏–π', emoji: 'ü©µ', range: [150, 195] },
            blue: { name: '–°–∏–Ω—ñ–π', emoji: 'üîµ', range: [195, 255] },
            purple: { name: '–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π', emoji: 'üü£', range: [255, 290] },
            magenta: { name: '–ü—É—Ä–ø—É—Ä–Ω–∏–π', emoji: 'ü©∑', range: [290, 320] },
            pink: { name: '–†–æ–∂–µ–≤–∏–π', emoji: 'üíó', range: [320, 345] }
        };

        function rgbToHsv(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const diff = max - min;

            let h = 0;
            const s = max === 0 ? 0 : diff / max;
            const v = max;

            if (diff !== 0) {
                if (max === r) {
                    h = ((g - b) / diff + (g < b ? 6 : 0)) / 6;
                } else if (max === g) {
                    h = ((b - r) / diff + 2) / 6;
                } else {
                    h = ((r - g) / diff + 4) / 6;
                }
            }

            return [h * 360, s * 100, v * 100];
        }

        function getColorName(h, s, v) {
            // –Ø–∫—â–æ –Ω–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å –¥—É–∂–µ –Ω–∏–∑—å–∫–∞ - —Ü–µ –≤—ñ–¥—Ç—ñ–Ω–∫–∏ —Å—ñ—Ä–æ–≥–æ
            if (s < 10) {
                if (v > 80) return { name: '–ë—ñ–ª–∏–π', emoji: '‚ö™' };
                if (v < 20) return { name: '–ß–æ—Ä–Ω–∏–π', emoji: '‚ö´' };
                return { name: '–°—ñ—Ä–∏–π', emoji: '‚ö™' };
            }

            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –∫–æ–ª—ñ—Ä –∑–∞ –≤—ñ–¥—Ç—ñ–Ω–∫–æ–º
            for (const [key, color] of Object.entries(colorNames)) {
                if (color.range.length === 4) {
                    // –î–ª—è —á–µ—Ä–≤–æ–Ω–æ–≥–æ (wraparound)
                    if (h >= color.range[0] && h <= color.range[1] || 
                        h >= color.range[2] && h <= color.range[3]) {
                        return color;
                    }
                } else {
                    if (h >= color.range[0] && h < color.range[1]) {
                        return color;
                    }
                }
            }

            return { name: '–ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∏–π', emoji: '‚ùì' };
        }

        function analyzeColor(imageData) {
            const data = imageData.data;
            let r = 0, g = 0, b = 0;
            const sampleSize = 100; // –ë–µ—Ä–µ–º–æ –∫–æ–∂–µ–Ω 100-–π –ø—ñ–∫—Å–µ–ª—å –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
            let count = 0;

            for (let i = 0; i < data.length; i += 4 * sampleSize) {
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
                count++;
            }

            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);

            const [h, s, v] = rgbToHsv(r, g, b);
            const color = getColorName(h, s, v);

            return {
                rgb: { r, g, b },
                hsv: { h: h.toFixed(0), s: s.toFixed(0), v: v.toFixed(0) },
                name: color.name,
                emoji: color.emoji
            };
        }

        function displayColorInfo(colorData) {
            const { rgb, hsv, name, emoji } = colorData;
            const bgColor = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
            
            const colorDisplay = document.getElementById('colorDisplay');
            colorDisplay.style.background = bgColor;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ, —á–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –±—ñ–ª–∏–π —á–∏ —á–æ—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç
            const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
            const textColor = brightness > 128 ? '#000' : '#fff';
            colorDisplay.style.color = textColor;
            
            document.getElementById('colorName').textContent = `${emoji} ${name}`;

            const colorInfo = document.getElementById('colorInfo');
            colorInfo.innerHTML = `
                <div class="result-item">
                    <div class="result-label">–ù–∞–∑–≤–∞ –∫–æ–ª—å–æ—Ä—É</div>
                    <div class="result-confidence">${emoji} ${name}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">RGB –∑–Ω–∞—á–µ–Ω–Ω—è</div>
                    <div class="result-confidence">R:${rgb.r} G:${rgb.g} B:${rgb.b}</div>
                </div>
                <div class="result-item">
                    <div class="result-label">HSV –∑–Ω–∞—á–µ–Ω–Ω—è</div>
                    <div class="result-confidence">H:${hsv.h}¬∞ S:${hsv.s}% V:${hsv.v}%</div>
                </div>
                <div class="result-item">
                    <div class="result-label">HEX –∫–æ–¥</div>
                    <div class="result-confidence">#${rgb.r.toString(16).padStart(2, '0')}${rgb.g.toString(16).padStart(2, '0')}${rgb.b.toString(16).padStart(2, '0')}</div>
                </div>
            `;
        }

        async function setupCamera() {
            video = document.getElementById('webcam');
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' },
                    audio: false 
                });
                video.srcObject = stream;
                
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        resolve(video);
                    };
                });
            } catch (error) {
                alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –¥–∞–ª–∏ –¥–æ–∑–≤—ñ–ª.');
                throw error;
            }
        }

        function captureAndAnalyze() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const colorData = analyzeColor(imageData);
            displayColorInfo(colorData);
        }

        document.getElementById('startBtn').addEventListener('click', async () => {
            await setupCamera();
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('analyzeBtn').style.display = 'inline-block';
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('analyzeBtn').style.display = 'none';
        });

        document.getElementById('analyzeBtn').addEventListener('click', captureAndAnalyze);

        document.getElementById('uploadBtn').addEventListener('click', () => {
            document.getElementById('uploadImage').click();
        });

        document.getElementById('uploadImage').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const colorData = analyzeColor(imageData);
                    displayColorInfo(colorData);
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É –≤—ñ–¥–µ–æ –µ–ª–µ–º–µ–Ω—Ç—ñ
                    video.style.display = 'block';
                    video.poster = URL.createObjectURL(file);
                };
                img.src = URL.createObjectURL(file);
            }
        });
    </script>
</body>
</html>
